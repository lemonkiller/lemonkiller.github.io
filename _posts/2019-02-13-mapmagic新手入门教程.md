---
layout:     post
title:      mapmagic新手入门教程
subtitle:   这个插件很棒,自来水一发
date:       2019-02-13
author:     lemonkiller
header-img: \img\mapmagic.jpg
excerpt: 逐渐补完mapmagic的入门教程
catalog: true
tags:
    - unity插件
    - unity
---
## 前言
一直对过程生成游戏内容很感兴趣,之前生啃了这个插件的基本用法

觉得不错,尝试把它介绍给中文世界,也是一次梳理和深入理解

受限于英文水平,也用了些机翻资料..

逐渐补完这篇入门文,大体思路是列出结构,补充细节,调整结构,补充细节,直到完毕这样

可随意转载,但烦请附带原文链接

### MapMagic介绍
这是一个节点式的自动生成unity地形的插件

可以预先生成地形,也可以在运行中生成地形

支持无限大地形
### 和其他插件的比较
![](/img/mapmagic_bijiao.png)
### 不足之处

目前不支持河流和道路的生成



## 快速上手
您需要做的第一件事是创建一个MapMagic对象，其中包含MapMagic脚本、初始地形，并允许打开编辑器界面。要创建MapMagic对象，请单击游戏对象菜单-> 3D对象-> MapMagic。一个名为“MapMagic”的新游戏对象将出现在层次菜单中。它已经有了最初的固定地形和三个示例生成器，所以地形并不平坦。单击此对象将在检查器中显示基本设置。

“固定地形”按钮允许在场景视图中选择固定地形。左键点击一个空白区域将会锁定一个地形，在地形生成后，它会马上出现。在已经固定的地形上左键点击将会取消固定。要退出锁定模式，再次点击“锁定地形”按钮。

对固定地形所做的任何更改将在下一次生成时重新写入。为了防止这种情况，按下“锁定地形”按钮并选择应该锁定的固定地形，使用地形锁定。当使用锁定地形时，尽量不要大幅修改高度，否则你可以在没有改变的锁定地形和它们的邻居之间获得明显的边界，这些邻居有一个新的程序性高度图。

在您创建的MapMagic对象中，“显示编辑器”按钮将打开编辑器窗口。这里你可以看到三个初始发生器:噪声、曲线和高度(输出发生器)，它们都连接在一起。可以使用鼠标中键滚动编辑器窗口。要放大或缩小，请使用滚轮。要重新定位生成器，请左键单击并拖动生成器窗口上的任意位置。

改变发电机的任何参数都会迫使发电机及其相关发电机重新计算。一旦发电机的结果准备好，地形就会改变。

MapMagic窗口中的“生成”按钮将强制重新计算编辑器中的所有生成器。

请注意，“生成”按钮图标会根据当前生成状态更改其外观:

当所有地形都已成功生成并且都是最新的时，将显示绿色“Ok”标记。
当至少一个地形当前正在生成时，将显示灰色“生成”标记(动画)。
红色“错误”标记表示生成器图形存在连接错误:要么强制连接为空，要么连接类型错误，要么图形具有无限循环。错误连接将在图上以红色显示。
当“生成”按钮旁边没有显示任何内容时，地形尚未生成。这在设置中关闭“即时生成”功能时很常见。

“生成”按钮旁边是“全局种子”字段。这个数字用于初始化伪随机生成器。请注意，伪随机生成器使用自己的种子参数，因此最终结果取决于全局种子和生成器种子参数。

右键单击空字段，然后从弹出菜单中选择创建- >生成器类型- >生成器，即可创建新生成器。请注意，所有生成器都按类型分组:

地图生成器仅与其他地图生成器连接。他们的输入和输出总是地图。
对象生成器仅与其他对象生成器连接。他们可能有也可能没有地图输入/输出，但对象始终存在。
输出生成器直接设置地形并放置对象。
“门户”实际上不是一个生成器，而是一种连接技术。不要让这个名字愚弄你——它不是关于其他地形或维度的空间洞，它只是更好地组织图表的一种方式。当设置为输入时，该门户会创建一个“无线”连接，该连接可以与匹配的输出门户配对，输入到图形的另一个位置，最大限度地减少显示的长而杂乱的电线数量。

通过右键单击生成器并从弹出菜单中选择“删除”，可以删除生成器。

新创建的发电机可以连接到当前现有的发电机系统。只需将它的输入或输出图标拖放到另一个生成器的输入或输出上。请注意，生成器的输出可以有多个连接，而输入只接受一个连接。一些发电机输入是强制性的，这意味着它们总是需要一些输入，如果没有连接，发电将会失败。空的强制输入用红色星号高亮显示。

![](/img/MapMagic/QuickGuideEditor.jpg)

任何地图生成器的任何输出都可以使用预览功能查看。右键单击地图输出，然后选择预览- >地形。这将根据预览地图值以红色到绿色的颜色范围对地形进行着色。高地图值为绿色，而低值为红色。

要退出预览模式，请右键单击编辑器中的任意位置，然后选择预览- >清除。

此外，地图可以在单独的窗口中预览。单击预览- >在窗口中，将打开一个显示灰度地图的窗口。这个地图可以像主图形一样滚动和缩放。

![](/img/MapMagic/Preview.jpg)

## 设置

选择地图魔术对象时，可以在检查器选项卡中找到常规和地形设置。

常规设置设置地图魔术的参数:

分辨率设置输入和输出地图大小。提高分辨率将创造更详细的地形，但请注意，生成时间将呈平方增长。例如，对于512的地图大小，计算侵蚀发生器(最慢的发生器之一)需要大约2秒，而对于1024的地图大小，相同的操作需要超过7秒。
地形大小以单位设置地形边的长度。此参数仅改变地形对象的比例，不影响性能。请注意，更改尺寸参数需要地形调整，以使地形看起来成比例。
地形高度设置最大地形高程，即值为1的地图像素将在此级别设置地形。
生成无限地形-启用后，当主摄像机靠近边缘时，这将在播放模式下动态生成新的地形，从而创建一个几乎无限的世界。

生成范围-到触发地形生成的地形边界的最小距离。请注意，当到达生成范围时，地形不会立即出现，因为生成需要一些时间，这取决于图形生成器的复杂性。此参数确保生成或开始生成范围内的所有地形。
轨迹计数-当地形不再位于“生成范围”距离内时，地图魔术会移除这些地形，但是如果玩家在离开后想要返回到地形，有一个地形池没有被破坏，并被命名为“轨迹”:当沿着这条线移动时，这些地形会形成相机后面的轨迹。此参数设置未着色的地形池大小。

请注意，在游戏模式下，固定地形永远不会被破坏。这使得手动修改它们成为可能，例如，在自动荒野地形中包括手工村庄。

多线程:启用时，Map Magic在几个单独的线程中工作。关闭此参数将强制Map Magic仅在主线程中工作(这可能有助于调试自定义生成器或出于兼容性原因)。
即时生成:启用此参数后，在更改任何生成器参数后，无需按“生成”按钮: Map Magic会触发更改，并在您更改图形中的每个节点时自动强制生成。
保存中间结果: Map Magic保存每个生成器的每个地形的输出结果，因此在生成器更改时，不需要重新生成所有内容:只计算生成器的更改及其相关性。禁用该参数时，MapMagic将在生成完成后清除所有生成器映射。禁用此选项可以减少内存占用，但每次任何生成器更改时，整个图表都将从头开始重新生成，这可能需要一些时间，具体取决于图表的复杂性。
焊缝边缘:由于所有的地形都是独立生成的，一些算法，如模糊或侵蚀，可能会在地形的边界上产生不同的结果。为了消除这种差异，地图魔术创造了从一个地形到另一个地形的平滑过渡。“边距”参数是过渡的大小(以像素为单位)。当参数为0时，地形焊接关闭。

高度焊接余量:应用于高度贴图焊接的余量
Splat焊接余量:适用于地形纹理焊接的余量。由于纹理差异不如高度差异明显，建议将此参数设置为低于高度焊接余量。

请记住，使用高边界值会导致更长的应用时间(即Unity生成后冻结的时间)，并可能导致浮动对象错误(当地形降低到对象下方以执行焊接时)。保持这些值尽可能低，并使用安全边界参数来抵消地形差异。

隐藏远固定地形:隐藏不在生成范围内的固定地形，否则将始终显示。禁用此功能会造成地形漂浮在空中的效果，降低性能。
将图层和标签复制到地形:打开地图魔术后，所有分配给地图魔术对象的标签和图层都会在生成时复制到地形。
将组件复制到地形:打开地图魔术时，所有分配给地图魔术对象的脚本(除了地图魔术本身)都会在生成时复制到地形。

“地形设置”和“树”、“细节”和“草”设置等同于标准地形的“设置”选项卡中用于每个地形的设置。唯一不同的是，它们被应用于所有MapMagic地形。有关详细信息，请参阅Unity文档。

## 地图生成节点

形象地说，地图是一个单通道的方形光栅图像（如果你更像是一个程序员而不是艺术家，那么二维浮动数组）。所有的地图生成器都由一个原则联合起来：它们的输入和输出连接类型是Map。

大多数生成器使用0  -  1值间隔。例如，在高度输出中，1是设置中定义的最大高度;对于面具0表示完全透明，1  - 完全不透明。

许多Map生成器具有等效参数。为方便起见，将它们统一列在此处，不会再对每个生成器重复说明。有些生成器可以拥有所有这些参数，其他生成器只能拥有其中一些参数，其余的则根本没有。

输入：

    输入 - 生成器要处理的映射。

    蒙版 - 将生成器强度乘以蒙版贴图的值。对于值为0的掩码像素，生成器效果是不可见的，对于值为1的像素，强度不变。

输出：

    输出 - 存储生成器的处理结果，并允许您连接到其他输入。

属性：

    强度 - 生成器对输入映射的影响量。当该值设置为0时，生成器效果不可见。换句话说，它是生成器的有效不透明度。

![](/img/MapMagic/MapAmount.jpg)

安全边框 - 屏蔽地形边界，使边界上的生成器效果为零，并随着距边界的距离而增加。 此参数设置效果的全部强度之前的量（以像素为单位）。 设置为0时，边框遮罩处于关闭状态。 此参数对于更好的地形焊接至关重要，因此如果此生成器输出到高度，则始终启用此参数。
![](/img/MapMagic/MapMaskBorders.jpg)

种子是用于初始化伪随机噪声发生器的数字。 如果两个生成器使用相等的种子数，则生成的模式将是相同的。

### Constant

创建一个填充给定参数的地图。 这是最简单的生成器，用于创建透明蒙版或平面高度图。

输出：平面处于一定水平高度。

属性：地图将在生成时填充此值。 值范围介于0（无填充，透明填充或零地面水平，具体取决于将使用的输出）和1（完全不透明填充或最大地形高度）。

### Noise

Noise Generator是MapMagic中最基本的生成器之一。 它生成一个柏林噪声图，广泛用作各种地图创建算法的基础。

输入：

    输入 - 如果未指定输入，则噪声发生器返回纯噪声。 如果指定了输入，则在输入映射上方添加（+）噪声。
    蒙版 - 控制生成器强度水平的地图。

输出：

    输出 - 噪声图（如果未指定输入）或添加了噪声的输入图（如果指定了输入）。

属性：

    大小 - 此参数确定最大分形的大小。 高于此值的噪声不再是分形，而是标准的perlin噪声。 较小的尺寸值会产生非常均匀和可预测的噪音，而较高的值会产生不同的噪音和风景高度图。
![](/img/MapMagic/NoiseSize.jpg)
### Voronoi

使用Voronoi模式创建地图。将地图拆分为单元格，为每个单元格生成随机点，并使用到最近点和第二个最近点的评估距离填充地图。 Voronoi地图看起来像一个由不规则凸多边形组成的mosaiс。

输入：

    输入 - 如果未指定输入，Voronoi生成器将返回纯Voronoi映射。如果指定了输入，则在输入映射上方添加（+）Voronoi效果。
    蒙版 - 控制发电机强度水平的地图。

输出：

    输出 -  voronoi模式（如果未指定输入）或添加了voronoi模式的输入映射（如果指定了输入）。

属性：

    类型：确定最终高度的精确计算方式：

    平面：使用单元格点的值填充所有最近的像素
    最近：填充距离最近点值的像素
    第二近似：与最近相同，除了计算到第二个最近点的距离
    蜂窝：到第二个最近点的距离减去到最近点的距离。
    有机：到第二个最近点的距离加上到最近点的距离。
    ![](/img/MapMagic/VoronoiType1.jpg)
    ![](/img/MapMagic/VoronoiType2.jpg)

细胞计数：细胞数量。 此参数设置Voronoi模式的大小：计数越大，多边形大小越小。 为了更好的地形焊接，建议使用两个电池计数的功率，但这不是强制性的。
![](/img/MapMagic/VoronoiCellcount.jpg)

均匀性:确定单元点的偏移，并因此确定多边形的多样性。值为1时，所有多边形都相等，并且随着均匀度值的降低，它们变得更加独特。
![](/img/MapMagic/VoronoiUniformity.jpg)
种子:用于初始化伪随机Voronoi生成器的数字。
### Curve
使用用户定义的曲线调整地图值。它的工作原理类似于Photoshop等图形编辑器中的曲线调整。曲线图的横轴是输入值，纵轴是输出值。

Map Magic使用Unity的动画曲线界面进行曲线编辑，因此使用曲线生成器也是如此。可以用鼠标左键拖动按键和切线，鼠标右键用于创建新按键和访问按键属性。

这个生成器为地图编辑提供了大量的机会:它可以用来反转地图，调整最小值或最大值，钳制地图值，甚至制作阶梯坡度(尽管梯田生成器在这方面可能更方便)。

例如，为了给地图更多的对比度，只需将左右键水平移动到更靠近中心线的位置。要反转地图，请将左键移动到顶部，将右键移动到底部，以便反转对角线(请注意，关键切线应设置为自动以获得直线)。

输入(强制) -源地图

输出-已处理的地图

属性:

范围:默认情况下，0到1之间的整个值范围用于编辑。为了更精确的编辑，可以为输入和输出设置最小值和最大值。相同的参数可用于创建负值映射或值超过1的映射。
![](/img/MapMagic/Curves1.jpg)
![](/img/MapMagic/Curves2.jpg)
### Raw Input
原始输入生成器旨在导入。原始高度地图作为地图魔法地形的基础。为了使用它。原始文件应该正确准备。应该是:

正方形(宽度应等于长度)
灰度
每个通道16位
它应该被保存为。具有PC字节顺序的原始文件

高度图保存在哪里并不重要，无论它是否是资产文件夹，导入时都会转换成矩阵格式并保存在场景中。拯救了。可以通过“浏览”按钮添加原始文件。请注意，MapMagic没有跟踪高度地图的变化，因此任何变化后都应该按下“刷新”按钮。

输出-应用为MapMagic地图的RAW图像。

属性:

数量:决定地图对地形的影响程度。
比例:设定高度图的大小。默认情况下，大小等于一个地形。
![](/img/MapMagic/RawInputSize.jpg)

offset:沿X轴或Z轴移动高度贴图。

tile:将重复高度图，这样每个地形点都不会错过地图。

![](/img/MapMagic/RawInputTile.jpg)

### Blend
使用指定的混合算法将两个地图混合在一起。此生成器的行为与Photoshop或其他图形编辑器中的图层混合模式非常相似。将“基础”地图输入视为底层图层，“混合”地图输入是混合图层。

一些生成器，如噪声或voronoi，有自己的混合输入:加法(输入)和乘法(掩码)。在大多数情况下，使用它们就足够了，但在某些情况下，您可能需要另一种混合类型，或者需要混合发电机链或没有混合输入的发电机。创建混合生成器就是为了解决这个问题。

投入:

基础-基础地图图层
混合-混合层
遮罩-控制发生器强度等级的地图。

产出:

输出-混合结果。

属性:

算法-确定图层的混合方式
不透明度-混合层不透明度系数。如果该值为0，则混合结果不可见。

以下是混合生成器提供的算法:

混合:使用不透明度值简单地混合两个地图算法的公式是{返回b }；
添加:将混合层添加到基础层，即层{ a + b；ˇ
减去:从基层{ a - b；ˇ
乘:乘两层。请注意，由于大多数情况下输入值小于1，因此相乘的值将小于任何输入值。{ a* b；ˇ
除:与乘法相反。结果通常会超过1，所以要小心使用。(甲/乙)；ˇ
差异:两层之间的差值{ Mathf。防抱死制动系统(甲-乙)；ˇ
最小值:两层之间的最小值。{马修。最低(甲、乙)；ˇ
最大值:两层之间的最大值。尝试用最小和最大混合算法进行实验，因为它们可以带来干净和有用的结果{ Mathf。马克斯(甲，乙)；ˇ
叠加:这种效果经常被用来处理图像，但是用它来混合高度或平面地图的可行性值得怀疑。

如果( a > 0.5f )返回1 - 2 * ( 1 - a ) * ( 1 - b

否则返回2 * a* b；

![](/img/MapMagic/Blend1.jpg)
![](/img/MapMagic/Blend2.jpg)
![](/img/MapMagic/Blend3.jpg)

### Blur

平滑输入地图。

投入:

输入-要由生成器处理的默认映射。

遮罩-控制发生器强度等级的地图。

产出:

输出-存储生成器的处理结果。

属性:

强度:每次迭代应用的模糊量。
迭代:应用模糊迭代的次数。请注意，增加迭代次数会降低模糊性能。如果您希望使用Loss参数获得更多地图平滑度，最大合理迭代次数约为10次。
![](/img/MapMagic/BlurIterations.jpg)
损失:强制生成器跳过一些输入像素。这将导致更多的“像素化”外观，但会给地图带来额外的平滑度。值1表示不会跳过任何像素。Loss参数对性能几乎没有影响，因此它可以用来创建极其平滑的地图。将其与高强度和迭代计数一起使用，以避免明显的像素化。
![](/img/MapMagic/BlurLoss.jpg)


#### 物体生成节点
#### 输出节点
#### 自定义节点 

## 相关链接

unity商店地址:https://assetstore.unity.com/packages/tools/terrain/mapmagic-world-generator-56762

插件主页:http://www.denispahunov.ru/MapMagic/

相关wiki:https://gitlab.com/denispahunov/mapmagic/wikis/home

Unity3d 地形制作交流群:493200979,这个群里用各种地形制作软件的人都有,欢迎加入


